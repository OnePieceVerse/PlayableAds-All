<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Callback</title>
    <link rel="icon" href="assets/favicon.ico" type="image/x-icon">
</head>

<body>
    <script src="https://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js" data-appid="102796919"
    data-redirecturi="https://playableall.com/admin.html" charset="utf-8"></script>
    <script>
        // 解析URL中的token和state参数
        // const hashParams = new URLSearchParams(window.location.hash.substring(1));
        // const accessToken = hashParams.get('access_token');
        // const state = hashParams.get('state');

        // if (accessToken && state === sessionStorage.getItem('qq_state')) {
        //     // 验证通过后操作父窗口
        //     if (window.opener) {
        //         window.opener.postMessage({
        //             type: 'qq_login_success',
        //             token: accessToken
        //         }, 'https://playableall.com'); // 限制消息来源域名

        //         window.close(); // 关闭当前子窗口
        //     }
        // }

        // 回调页面中自动关闭窗口并传递数据
        if (window.opener) {
            QC.Login.getMe(function (openId, accessToken) {
                window.opener.postMessage({
                    type: 'qq_login_success',
                    openId,
                    accessToken
                }, 'https://playableall.com'); // 限制消息来源域名
                window.close(); // 关闭子窗口
            });
        }
    </script>
</body>

</html>